<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Vayatis -- 2.1 -- Joaillerie</title>

  <meta name="author" content="Mohamad Ghassany" />

  
  <meta name="description" content="test">
  

  <link rel="alternate" type="application/rss+xml" title="Mohamad Ghassany - Data scientist" href="/feed.xml" />

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
    
  

  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
  

  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

  

  

  

    <!-- Facebook OpenGraph tags -->
  

  
  <meta property="og:title" content="Vayatis -- 2.1 -- Joaillerie" />
  

   
  <meta property="og:description" content="test">
  


  <meta property="og:type" content="website" />

  
  <meta property="og:url" content="http://mghassany.github.io/2014-12-12-Vayatis/" />
  <link rel="canonical" href="http://mghassany.github.io/2014-12-12-Vayatis/" />
  

  
  <meta property="og:image" content="http://mghassany.github.io/img/mypic.png" />
  
  

  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@m_ghass" />
  <meta name="twitter:creator" content="@m_ghass" />

  
  <meta name="twitter:title" content="Vayatis -- 2.1 -- Joaillerie" />
  

  
  <meta name="twitter:description" content="test">
  

  
  <meta name="twitter:image" content="http://mghassany.github.io/img/mypic.png" />
  

</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
<!--       remove navbar-brand to remove name in order to put photo on left
 --><!--       <a class="navbar-brand" href="http://mghassany.github.io">Mohamad Ghassany</a>
 -->    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            
            





<a href="/">About me</a>

          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Research</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/research/projects">Projects</a>

                
              
                
                  
            





<a href="/research/myphd">Phd Thesis</a>

                
              
                
                  
            





<a href="/research/publications">Publications</a>

                
              
            </div>
          </li>
        
        
        
          <li>
            
            





<a href="/teaching">Teaching</a>

          </li>
        
        
        
          <li>
            
            





<a href="/blog">Blog</a>

          </li>
        
        
      </ul>
    </div>

	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://mghassany.github.io ">
	      <img class="avatar-img" src="/img/mypic.png" />
		</a>
	  </div>
	</div>
	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Vayatis -- 2.1 -- Joaillerie</h1>
		  
		    
			<h2 class="post-subheading">test</h2>
			
		  
		  
		  
		  <span class="post-meta">Posted on December 12, 2014</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

      <article role="main" class="blog-post">
        <ul id="markdown-toc">
  <li><a href="#rappel--les-variables-calcules" id="markdown-toc-rappel--les-variables-calcules">Rappel : Les variables calculées</a></li>
  <li><a href="#acp" id="markdown-toc-acp">ACP</a></li>
  <li><a href="#kmeans" id="markdown-toc-kmeans">KMEANS</a>    <ul>
      <li><a href="#nombre-de-clusters" id="markdown-toc-nombre-de-clusters">Nombre de clusters</a></li>
      <li><a href="#kmeans-avec-4-groupes-" id="markdown-toc-kmeans-avec-4-groupes-">Kmeans avec 4 groupes :</a></li>
      <li><a href="#quelques-asi-du-cluster-1--15-asis" id="markdown-toc-quelques-asi-du-cluster-1--15-asis">Quelques ASI du cluster 1  (15 ASIs):</a></li>
      <li><a href="#quelques-asi-du-cluster-4-" id="markdown-toc-quelques-asi-du-cluster-4-">Quelques ASI du cluster 4 :</a></li>
      <li><a href="#quelques-asi-du-cluster-2-" id="markdown-toc-quelques-asi-du-cluster-2-">Quelques ASI du cluster 2 :</a></li>
      <li><a href="#quelques-asi-du-cluster-3-" id="markdown-toc-quelques-asi-du-cluster-3-">Quelques ASI du cluster 3 :</a></li>
      <li><a href="#kmeans-avec-3-groupes-" id="markdown-toc-kmeans-avec-3-groupes-">Kmeans avec 3 groupes :</a></li>
    </ul>
  </li>
  <li><a href="#suite" id="markdown-toc-suite">Suite</a></li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># to calculate time spent
# ptm &lt;- proc.time()
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"~/Dropbox/TEM/CuratedMedia/source_separation/Joaillerie.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">","</span><span class="p">,</span><span class="n">fileEncoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UTF-8"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.table</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
 
</span><span class="c1"># proc.time() - ptm
</span><span class="w"> 
</span><span class="c1"># fread is equivalent to read.csv but much faster and loads as data.table (from data.table library). sep is automatic and header is automatic
</span><span class="w"> 
</span><span class="err">#</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="s2">"~/Dropbox/TEM/CuratedMedia/source_separation/Joaillerie.csv"</span><span class="p">)</span></code></pre></figure>

<p>Précédemment j’ai fait quelques analyses sur le cas ‘Banque’. Dans ce rapport je ferai une analyse sur le cas ‘Joaillerie’.</p>

<p>A noter avant de commencer que LinkFluence ont mi à jour leur plateforme Radarly pendant cette semaine. Ils ont changé l’interface.
J’ai téléchargé les données de clusters du corpus Joaillerie.</p>

<p><strong>Tout d’abord</strong>, une surprise inattendue après avoir téléchargé les données, ajouté les ids des clusters, et mergé les fichiers. En important le tableau Joaillerie dans R, je remarque que le nombre de colonnes dans ce tableau est 63, contre 27 dans les anciennes versions de Radarly (donc les données Banque téléchargés).</p>

<p>Et les noms de variables ne sont le mêmes que les anciennes variables.
Ce qui m’oblige à re editer le code des anciennes analyses pour traiter maintenant Joaillerie.</p>

<p>Voici d’abord la liste des variables dans ce tableau :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> [1] "date"                        "text"                       
 [3] "title"                       "permalink"                  
 [5] "site.name"                   "queries"                    
 [7] "lang"                        "tone"                       
 [9] "platform"                    "post.type"                  
[11] "author"                      "screen.name"                
[13] "gender"                      "avatar"                     
[15] "inferred.country"            "inferred.region"            
[17] "inferred.city"               "inferred.longitude"         
[19] "inferred.latitude"           "inferred.country.population"
[21] "inferred.region.population"  "inferred.city.population"   
[23] "declared.country"            "declared.region"            
[25] "declared.city"               "declared.longitude"         
[27] "declared.latitude"           "declared.country.population"
[29] "declared.region.population"  "declared.city.population"   
[31] "twitter.author.id"           "twitter.verified.author"    
[33] "twitter.followers"           "twitter.retweets"           
[35] "twitter.retweed.of"          "twitter.replies"            
[37] "facebook.author.id"          "facebook.type"              
[39] "facebook.fans"               "instagram.author.id"        
[41] "instagram.followers"         "web.pagerank"               
[43] "web.inbound.links"           "web.shares.on.twitter"      
[45] "web.comments"                "impressions"                
[47] "estimated.reach"             "embedded.url"               
[49] "media.type"                  "media.url"                  
[51] "favorite"                    "keywords"                   
[53] "hashtags"                    "mentions"                   
[55] "named.entities"              "story"                      
[57] "topic"                       "facebook.likes"             
[59] "youtube.dislikes"            "facebook.shares"            
[61] "comments"                    "twitter.favorites"          
[63] "clusterID"                  </code></pre></figure>

<p>Quelques nouvelles variables qui pourront être intéressantes :</p>

<ul>
  <li><code class="highlighter-rouge">site.name</code></li>
  <li><code class="highlighter-rouge">post.type</code></li>
  <li><code class="highlighter-rouge">author</code> &amp; <code class="highlighter-rouge">screen.name</code> (nom d’utilisateur et son identifiant)</li>
  <li><code class="highlighter-rouge">gender</code> (estimation du genre (M F))</li>
  <li><code class="highlighter-rouge">avatar</code> (lien url du photo  du compte)</li>
  <li><code class="highlighter-rouge">inferred.longitude</code> &amp; <code class="highlighter-rouge">inferred.latitude</code> &amp; <code class="highlighter-rouge">infered.country.popoulation</code> (si on a la localisation, dans la variable <code class="highlighter-rouge">inferred.country</code>)</li>
  <li><code class="highlighter-rouge">twitter.followers</code> &amp; <code class="highlighter-rouge">facebook.fans</code> &amp; autres (réactions par plateforme)</li>
  <li><code class="highlighter-rouge">web.pagerank</code> (si un site web, son pagerank)</li>
  <li><code class="highlighter-rouge">story</code> (celle ci c’est l’id du cluster, donc les ids que j’ajoute manuellement, l’avantage d’avoir cela c’est de pouvoir demander de télécharger tous les données joaillerie en un seul coup, ces données vont inclure cette variable et on a donc tous les clusters).</li>
</ul>

<!-- # Montrons d'abord quelques ASI (clusters) -->

<!-- Les 20 premiers clusters :  -->

<!-- ```{r} -->
<!-- for (i in 1:20) { -->

<!--   subset <- data[clusterID == i] -->

<!--   #extraction de dates pour créer ASI (Activity Signal of Interest) -->
<!--   dates <- as.POSIXct(subset$date,format="%d/%m/%Y %H:%M") -->
<!--   rounded_dates <- round(dates , "hour") -->
<!--   rounded_dates <- as.POSIXct(rounded_dates) -->
<!--   Period_days <- difftime(max(rounded_dates),min(rounded_dates)) -->
<!--   Period_days <- round(Period_days,2) -->
<!--   Period_hours <- difftime(max(rounded_dates),min(rounded_dates), units = "hours") -->
<!--   Period_hours <- round(Period_hours,2) -->
<!--   Occurences <- length(rounded_dates) -->

<!--   freq <- plyr::count(rounded_dates) -->

<!--   df1.zoo<-zoo(freq[,-1],freq[,1]) #set date to Index -->

<!--   df2 <- merge(df1.zoo,zoo(,seq(start(df1.zoo),end(df1.zoo),by="hour")), all=TRUE) -->

<!--   ASI <- data.frame(Date=time(df2), df2, check.names=FALSE, row.names=NULL) -->
<!--   colnames(ASI) <- c("date", "freq") -->
<!--   rm(df1.zoo,df2) -->
<!--   ASI[is.na(ASI)] <- 0 -->

<!--   # plot(ASI$date,ASI$freq,type="b",col="blue",xlab="",ylab="") -->
<!--   # mtext(paste("ASI",i,"\n","T = ",Period_days, " days \n","#Occurences = ", Occurences, " posts" )) -->
<!--   #  -->
<!--   print( -->
<!--   ggplot(ASI, aes(x=as.character(date), y=freq,group=1)) + -->
<!--     geom_line(color="blue") + -->
<!--     geom_point(color="blue") + -->
<!--     expand_limits(y=0) + -->
<!--     theme_minimal() + -->
<!--     ggtitle(paste("ASI of cluster",i,sep=" ")) + -->
<!--     xlab("time") + -->
<!--     theme(axis.text.x = element_blank())  + -->
<!--     annotate("text", color= "blue", size = 5, x=Inf, y = Inf, label = paste("T = ",Period_days, " days \n", "T = ", Period_hours, " hours \n", "#Occurences = ", Occurences, " posts" ), vjust=1, hjust=1) -->
<!-- ) -->

<!-- } -->
<!-- ``` -->

<!-- > Je remarque déjà qu'il y a plusieurs profils de cascade. Espérons avoir des bons groupes en faisant la classification. -->

<h1 id="rappel--les-variables-calcules">Rappel : Les variables calculées</h1>

<p>Les variables calculées en première version :</p>

<p>For every ASI :</p>

<p>$s_c$ is an ASI discrete time signal of length $T$ for the cascade $c$.</p>

<ul>
  <li><strong>sumAct</strong> : sum of total activity (number of meme posts)</li>
  <li><strong>maxAct</strong> : max activity level</li>
  <li><strong>meanAct</strong> : mean activity level( sumAct/T )</li>
  <li><del><strong>median-to-mean</strong> : median($s_c$)/meanAct</del> (<strong>Remarque</strong>:j’obtiens toujorus des 0) <strong>Laissé tomber</strong></li>
  <li><strong>varAct</strong> : variance of the activity level <script type="math/tex">\frac{1}{T}\sum_T (meanAct - s_c(t))^2</script></li>
  <li><strong>actLen</strong> : total activity length, the time between the first and the last observed activity in the signal $s_c$. (<strong>in hours ?</strong>)</li>
  <li><strong>peaksNum/actLen</strong> : the ratio of the number of peaks existing in the signal to its active length. As a peak is identified a single value of the signal that is significantly higher than its two neighboring values, the one before and the one after it.</li>
  <li><strong>maxZeroIntval/actLen</strong> : the ratio of the longest pause of signal where we observe zero values during the active length to that length (actLen).</li>
  <li>
    <p><strong>maxNonZeroIntval/actLen</strong> : same as in maxZeroIntval/actLen but for the longest non-zero part of the signal.</p>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><strong><script type="math/tex">V_c</script></strong> : number of activated node = $$</td>
          <td>G_c</td>
          <td>$$.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p><strong>reactions</strong> : somme de likes +  shares + retweets + comments + replies + favorites</p>
  </li>
  <li><strong>sumImp</strong> : la somme des impressions (distinct users)</li>
</ul>

<p>Ratios Platformes :</p>

<ul>
  <li><strong>ratioTwitter</strong></li>
  <li><strong>ratioFacebook</strong></li>
  <li><strong>ratioMedia</strong></li>
  <li><strong>ratioBlog</strong></li>
  <li><strong>ratioWebsite</strong></li>
</ul>

<p>Les variables qu’on souhaite ajouter dans cette version sont :</p>

<p>Sentiment analysis :</p>

<ul>
  <li><strong>Sentiment</strong> : <script type="math/tex">\frac{\# negative}{sumAct} \times (-1)$ + $\frac{\# positive}{sumAct} \times (1)</script></li>
</ul>

<!-- ~~Corpus~~ :  -->

<!-- - **ratioLaBanquePostale**  -->
<!-- - **ratioCreditMutuel**  -->
<!-- - **ratioSociétéGénérale**  -->
<!-- - **ratioCIC**  -->
<!-- - **ratioCreditAgricole**  -->
<!-- - **ratioBNPParibas**  -->
<!-- - **ratioBanquePopulaire**  -->
<!-- - **ratioINGDirect**  -->

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># corpusJoaillerie &lt;- c("LaBanquePostale","CreditMutuel","SociétéGénérale","CIC","CreditAgricole","BNPParibas","BanquePopulaire","INGDirect")
</span><span class="w"> 
</span><span class="c1">#création d'une matrice clusters pour faire ACP et Kmeans de ces clusters
# clusters &lt;- data.frame(clusterId= integer(0), sumAct= integer(0), maxAct = integer(0), meanAct=numeric(0),varAct = numeric(0),actLen = numeric(0),peaksNum_actLen = numeric(0),maxZeroIntval_actLen = numeric(0),maxNonZeroIntval_actLen = numeric(0),V_c = numeric(0),reactions = numeric(0),sumImp = numeric(0),sentiment = numeric(0),ratioLaBanquePostale = numeric(0),ratioCreditMutuel = numeric(0),ratioSociétéGénérale = numeric(0),ratioCIC = numeric(0),ratioCreditAgricole = numeric(0),ratioBNPParibas = numeric(0),ratioBanquePopulaire = numeric(0),ratioINGDirect = numeric(0),ratioTwitter = numeric(0),ratioFacebook = numeric(0),ratioMedia = numeric(0),ratioBlog = numeric(0),ratioWebsite = numeric(0))
</span><span class="w"> 
</span><span class="n">clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">clusterId</span><span class="o">=</span><span class="w"> </span><span class="n">integer</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">sumAct</span><span class="o">=</span><span class="w"> </span><span class="n">integer</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">maxAct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integer</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="n">meanAct</span><span class="o">=</span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">varAct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">actLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">peaksNum_actLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">maxZeroIntval_actLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">maxNonZeroIntval_actLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">V_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">reactions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">sumImp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">sentiment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">ratioTwitter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">ratioFacebook</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">ratioMedia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">ratioBlog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">),</span><span class="n">ratioWebsite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">0</span><span class="p">))</span><span class="w">
 
</span><span class="c1"># ids &lt;- c(1:49,51:100)
</span><span class="n">ids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="w">
 
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ids</span><span class="p">){</span><span class="w">
 
  </span><span class="c1">#subset du cluster i
</span><span class="w">  </span><span class="n">subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">clusterID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">
 
  </span><span class="c1">#extraction de dates pour créer ASI (Activity Signal of Interest)
</span><span class="w">  </span><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%d/%m/%Y %H:%M"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dates</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"hour"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">))</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_days</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hours"</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Occurences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
 
  </span><span class="c1"># for ASI that happen in the same hour 
</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">Period_hours</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">){</span><span class="w">
    </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">freq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
 
  </span><span class="n">df1.zoo</span><span class="o">&lt;-</span><span class="n">zoo</span><span class="p">(</span><span class="n">freq</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">freq</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#set date to Index
</span><span class="w"> 
  </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">zoo</span><span class="p">(,</span><span class="n">seq</span><span class="p">(</span><span class="n">start</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">end</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="s2">"hour"</span><span class="p">)),</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
 
  </span><span class="n">ASI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="n">df2</span><span class="p">),</span><span class="w"> </span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">ASI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="s2">"freq"</span><span class="p">)</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">df2</span><span class="p">)</span><span class="w">
  </span><span class="n">ASI</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ASI</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
 
 
  </span><span class="c1">#calcul de sumAct
</span><span class="w">  </span><span class="n">sumAct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de maxAct
</span><span class="w">  </span><span class="n">maxAct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de "meanAct"
</span><span class="w">  </span><span class="n">meanAct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sumAct</span><span class="o">/</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de "median-to-mean"
</span><span class="w">  </span><span class="n">median_to_mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">)</span><span class="o">/</span><span class="n">meanAct</span><span class="w">
 
  </span><span class="c1">#calcul de "varAct"
</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">Period_hours</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">varAct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">varAct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">var</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">#calcul de "actLen"
</span><span class="w">  </span><span class="n">actLen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de "peaksNum/actLen"
</span><span class="w">  </span><span class="n">require</span><span class="p">(</span><span class="n">quantmod</span><span class="p">)</span><span class="w">
  </span><span class="n">peaksNum_actLen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">findPeaks</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">))</span><span class="o">/</span><span class="n">actLen</span><span class="w">
 
  </span><span class="c1">#calcul de "maxZeroIntval/actLen"
</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">Period_hours</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">maxZeroIntval_actLen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">runs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rle</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">)</span><span class="w">
  </span><span class="n">maxZeroIntval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">runs</span><span class="o">$</span><span class="n">lengths</span><span class="p">[</span><span class="n">runs</span><span class="o">$</span><span class="n">values</span><span class="o">==</span><span class="m">0</span><span class="p">])</span><span class="w">
  </span><span class="n">maxZeroIntval_actLen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">maxZeroIntval</span><span class="o">/</span><span class="n">actLen</span><span class="w">
  </span><span class="p">}</span><span class="w">
 
 
  </span><span class="c1">#calcul de "maxNonZeroIntval/actLen"
</span><span class="w">  </span><span class="n">runs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rle</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span><span class="w">
  </span><span class="n">maxNonZeroIntval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">runs</span><span class="o">$</span><span class="n">lengths</span><span class="p">[</span><span class="n">runs</span><span class="o">$</span><span class="n">values</span><span class="o">==</span><span class="nb">T</span><span class="p">])</span><span class="w">
  </span><span class="n">maxNonZeroIntval_actLen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">maxNonZeroIntval</span><span class="o">/</span><span class="n">actLen</span><span class="w">
 
  </span><span class="c1">#calcul de "$V_c$" numbers of nodes (distinct authors in subset)
</span><span class="w">  </span><span class="n">V_c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">author</span><span class="p">))</span><span class="w">
 
  </span><span class="c1">#calcul de "reactions"     #A CORRIGER
</span><span class="w">  </span><span class="n">reactions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">twitter.retweets</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">twitter.replies</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">twitter.favorites</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">web.shares.on.twitter</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">web.comments</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">facebook.likes</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">facebook.shares</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">comments</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
    
 
  </span><span class="c1">#calcul de "sumImp"
</span><span class="w">  </span><span class="n">sumImp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">impressions</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de "sumReach"
</span><span class="w">  </span><span class="n">sumReach</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">estimated.reach</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de "meanImp"
</span><span class="w">  </span><span class="n">meanImp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">impressions</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de "meanReach"
</span><span class="w">  </span><span class="n">meanReach</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">estimated.reach</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#calcul de sentiment analysis (transformation de 3 facteur negative neutral positive)
</span><span class="w"> 
  </span><span class="n">sentiment</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">tone</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"positive"</span><span class="p">)</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">tone</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">tone</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"negative"</span><span class="p">)</span><span class="o">/</span><span class="nf">length</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">tone</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="m">-1</span><span class="p">)</span><span class="w">
 
 
  </span><span class="c1">#Calcul des ratios des Banques
</span><span class="w"> 
  </span><span class="n">queries.single</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">character</span><span class="p">()</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jj</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">))</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">strsplit</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">queries</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="s2">";"</span><span class="p">)</span><span class="w">
    </span><span class="n">queries.single</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">queries.single</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w">
  </span><span class="p">}</span><span class="w">
 
  </span><span class="c1"># ratioLaBanquePostale &lt;- sum(queries.single==corpusBanque[1])/sumAct
</span><span class="w">  </span><span class="c1"># ratioCreditMutuel &lt;- sum(queries.single==corpusBanque[2])/sumAct
</span><span class="w">  </span><span class="c1"># ratioSociétéGénérale &lt;- sum(queries.single==corpusBanque[3])/sumAct
</span><span class="w">  </span><span class="c1"># ratioCIC &lt;- sum(queries.single==corpusBanque[4])/sumAct
</span><span class="w">  </span><span class="c1"># ratioCreditAgricole &lt;- sum(queries.single==corpusBanque[5])/sumAct
</span><span class="w">  </span><span class="c1"># ratioBNPParibas &lt;- sum(queries.single==corpusBanque[6])/sumAct
</span><span class="w">  </span><span class="c1"># ratioBanquePopulaire &lt;- sum(queries.single==corpusBanque[7])/sumAct
</span><span class="w">  </span><span class="c1"># ratioINGDirect &lt;- sum(queries.single==corpusBanque[8])/sumAct
</span><span class="w"> 
  </span><span class="c1"># rm(temp,queries.single)
</span><span class="w"> 
  </span><span class="c1">#Plateformes
</span><span class="w"> 
  </span><span class="n">Twitter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="n">platform</span><span class="o">==</span><span class="s2">"Twitter"</span><span class="p">])</span><span class="w">
  </span><span class="n">Facebook</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="n">platform</span><span class="o">==</span><span class="s2">"Facebook"</span><span class="p">])</span><span class="w">
  </span><span class="n">Media</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="n">platform</span><span class="o">==</span><span class="s2">"Media"</span><span class="p">])</span><span class="w">
  </span><span class="n">Blog</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="n">platform</span><span class="o">==</span><span class="s2">"Blog"</span><span class="p">])</span><span class="w">
  </span><span class="n">Website</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="n">platform</span><span class="o">==</span><span class="s2">"Website"</span><span class="p">])</span><span class="w">
 
  </span><span class="n">ratioTwitter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Twitter</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="w">
  </span><span class="n">ratioFacebook</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Facebook</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="w">
  </span><span class="n">ratioMedia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Media</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="w">
  </span><span class="n">ratioBlog</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Blog</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="w">
  </span><span class="n">ratioWebsite</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Website</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="w">
 
  </span><span class="c1">#insertion dans la matrice finale
</span><span class="w"> 
      </span><span class="n">clusters</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">sumAct</span><span class="p">,</span><span class="n">maxAct</span><span class="p">,</span><span class="n">meanAct</span><span class="p">,</span><span class="n">varAct</span><span class="p">,</span><span class="n">actLen</span><span class="p">,</span><span class="n">peaksNum_actLen</span><span class="p">,</span><span class="n">maxZeroIntval_actLen</span><span class="p">,</span><span class="n">maxNonZeroIntval_actLen</span><span class="p">,</span><span class="n">V_c</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">sumImp</span><span class="p">,</span><span class="n">sentiment</span><span class="p">,</span><span class="n">ratioTwitter</span><span class="p">,</span><span class="n">ratioFacebook</span><span class="p">,</span><span class="n">ratioMedia</span><span class="p">,</span><span class="n">ratioBlog</span><span class="p">,</span><span class="n">ratioWebsite</span><span class="p">)</span><span class="w">
 
 
 
  </span><span class="p">}</span><span class="w">
 
</span><span class="c1"># rm(ASI,freq,subset)
</span><span class="w"> 
</span><span class="c1">#write.csv pour montrer les fichiers des clusters
</span><span class="w"> 
</span><span class="c1"># write.csv(clusters, file="clusters.csv", sep=",",fileEncoding = "UTF-8",row.names = FALSE)
</span><span class="w"> 
 
</span><span class="c1"># print(
#   ggplot(ASI, aes(x=as.character(date), y=freq,group=1)) +
#     geom_line(color="blue") +
#     geom_point(color="blue") +
#     expand_limits(y=0) +
#     theme_minimal() +
#     ggtitle(paste("ASI of cluster",id,sep=" ")) +
#     xlab("time") +
#     theme(axis.text.x = element_text(angle=90))  +
#     annotate("text", color= "blue", size = 5, x=Inf, y = Inf, label = paste("T = ",Period_days, " days \n", "T = ", Period_hours, " hours \n", "#Occurences = ", Occurences, " posts" ), vjust=1, hjust=1)
</span><span class="err">#</span><span class="w"> </span><span class="p">)</span></code></pre></figure>

<!-- Le tableau `clusters` est téléchargeable sur le lien suivant : [clusters.csv](https://dl.dropboxusercontent.com/s/eo32nybuyuhosuq/clusters.csv?dl=0) -->

<p>Alors j’ai un problème ici que je n’ai encore pu résoudre, c’est qu’il y a des clusters dont touts les posts sont la même heure ! du coup, on a des valeurs infinies et des champs nuls dans le tableau clusters et on ne peut pas procéder. 
Je trouverai une solution la semaine prochaine.</p>

<p>Un exemple est le cluster 70 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">clusters</span><span class="p">[</span><span class="m">70</span><span class="p">,]</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">   clusterId sumAct maxAct meanAct varAct actLen peaksNum_actLen
70        70     77     77      77      0      1               0
   maxZeroIntval_actLen maxNonZeroIntval_actLen V_c reactions sumImp
70                    0                       1  76         1  10638
   sentiment ratioTwitter ratioFacebook ratioMedia ratioBlog ratioWebsite
70         0    0.8701299             0 0.02597403         0    0.1038961</code></pre></figure>

<blockquote>
  <p>Solution : Dans ce cas , j’ai remplacé <code class="highlighter-rouge">Period_hours</code> (0 par 1), j’ai remplacé la Variance <code class="highlighter-rouge">varAct</code> (NA par 0, on obtiens NA parce qu’il y une seule heure), j’ai remplace <code class="highlighter-rouge">maxZeroIntval_actLen</code> (inf par 0)</p>
</blockquote>

<h1 id="acp">ACP</h1>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">corrplot</span><span class="p">)</span><span class="w">
</span><span class="n">corrplot</span><span class="p">(</span><span class="n">cor</span><span class="p">(</span><span class="n">clusters</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">clusters</span><span class="p">)]),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"lower"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /></p>

<p>Commentaires sur cette figure :</p>

<ul>
  <li>ratioWebsite toujours corrélée négativement avec ratioTwitter (donc le clusters s’agissent soit de Twitter soit Website)</li>
  <li>remarquable corrélation positive entre ratioWebsite et actLen, et corrélation négative entre ratioTwitter et actLen. Pour moi ça veut dire que quand le continu du cluster est du website ça se partage pour une préiode plus longue sur le web que lorsque c’est du contenu twitter.</li>
</ul>

<p>Voici les pourcentages que les composantes principales représentent</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#ACP
</span><span class="w"> 
</span><span class="c1">#scaling the matrix
</span><span class="n">clusters_scaled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">clusters</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">clusters</span><span class="p">)])</span><span class="w">
 
</span><span class="n">acp1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">princomp</span><span class="p">(</span><span class="n">clusters_scaled</span><span class="p">,</span><span class="w"> </span><span class="n">scores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">cor</span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">acp1</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Importance of components:
                          Comp.1    Comp.2    Comp.3    Comp.4     Comp.5
Standard deviation     2.1340996 1.5048758 1.4079833 1.3243036 1.15416660
Proportion of Variance 0.2679048 0.1332148 0.1166128 0.1031635 0.07835886
Cumulative Proportion  0.2679048 0.4011196 0.5177323 0.6208958 0.69925470
                           Comp.6     Comp.7     Comp.8     Comp.9
Standard deviation     1.08203892 1.03534553 0.98354325 0.87907552
Proportion of Variance 0.06887107 0.06305532 0.05690337 0.04545728
Cumulative Proportion  0.76812577 0.83118109 0.88808446 0.93354174
                         Comp.10    Comp.11    Comp.12     Comp.13
Standard deviation     0.5639965 0.51558565 0.45318052 0.387522484
Proportion of Variance 0.0187113 0.01563697 0.01208074 0.008833746
Cumulative Proportion  0.9522530 0.96789001 0.97997075 0.988804496
                           Comp.14     Comp.15     Comp.16      Comp.17
Standard deviation     0.317925386 0.236117519 0.183001315 2.459530e-03
Proportion of Variance 0.005945679 0.003279499 0.001969969 3.558404e-07
Cumulative Proportion  0.994750176 0.998029675 0.999999644 1.000000e+00</code></pre></figure>

<p>Les 4 premiers axes principaux représentent 62% de données (pas mal)
Avec 8 valeurs propres nous arrivons à 88%.
Avec 10 valeurs propres nous arrivons à 95%.</p>

<!-- Cette fois on n'a pas des bonnes pourcentages. -->
<!-- La première valeur propre (eigenvalue) interpréte 21%, la deuxième 11%, nous arrivons à 89% avec 12 valeurs propres.  -->
<!-- Avec 15 valeurs propres nous arrivons à 96%. -->

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#scree plot
</span><span class="err">#</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">acp1</span><span class="p">)</span></code></pre></figure>

<p>Nuage des points (les clusters) sur les deux premiers axes de composantes principales</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># create data frame with scores
</span><span class="n">scores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">acp1</span><span class="o">$</span><span class="n">scores</span><span class="p">)</span><span class="w">
 
</span><span class="c1"># plot of observations
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scores</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Comp.1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Comp.2</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">scores</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray65"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray65"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tomato"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"PCA plot"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /></p>

<!-- Cercle de corrélations -->

<!-- ```{r} -->

<!-- # function to create a circle -->
<!-- circle <- function(center = c(0, 0), npoints = 100) { -->
<!--     r = 1 -->
<!--     tt = seq(0, 2 * pi, length = npoints) -->
<!--     xx = center[1] + r * cos(tt) -->
<!--     yy = center[1] + r * sin(tt) -->
<!--     return(data.frame(x = xx, y = yy)) -->
<!-- } -->
<!-- corcir = circle(c(0, 0), npoints = 100) -->

<!-- # create data frame with correlations between variables and PCs -->
<!-- correlations = as.data.frame(cor(clusters_scaled, acp1$scores)) -->

<!-- # data frame with arrows coordinates -->
<!-- arrows = data.frame(x1 = c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), y1 = c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), x2 = correlations$Comp.1,y2 = correlations$Comp.2) -->

<!-- # geom_path will do open circles -->
<!-- ggplot() + geom_path(data = corcir, aes(x = x, y = y), colour = "gray65") + -->
<!--     geom_segment(data = arrows, aes(x = x1, y = y1, xend = x2, yend = y2), colour = "gray65") + -->
<!--     geom_text(data = correlations, aes(x = Comp.1, y = Comp.2, label = rownames(correlations))) + -->
<!--     geom_hline(yintercept = 0, colour = "gray65") + geom_vline(xintercept = 0, -->
<!--     colour = "gray65") + xlim(-1.1, 1.1) + ylim(-1.1, 1.1) + labs(x = "pc1 aixs", -->
<!--     y = "pc2 axis") + ggtitle("Circle of correlations") -->
<!-- ``` -->

<!-- Les deux figures précédentes superposées -->

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#biplot
</span><span class="n">biplot</span><span class="p">(</span><span class="n">acp1</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /></p>

<p>Même figure mais différentes couleurs et thème</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># library("devtools")
# install_github("kassambara/factoextra")
</span><span class="n">library</span><span class="p">(</span><span class="n">factoextra</span><span class="p">)</span><span class="w">
</span><span class="n">fviz_pca_biplot</span><span class="p">(</span><span class="n">acp1</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggfortify</span><span class="p">)</span><span class="w">
</span><span class="n">autoplot</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">loadings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">loadings.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<h1 id="kmeans">KMEANS</h1>

<h2 id="nombre-de-clusters">Nombre de clusters</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data_for_clustering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">clusters</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">clusters</span><span class="p">)]</span><span class="w">
</span><span class="n">wss</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_for_clustering</span><span class="p">)</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="nf">sum</span><span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">data_for_clustering</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">var</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">15</span><span class="p">)</span><span class="w"> </span><span class="n">wss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">kmeans</span><span class="p">(</span><span class="n">data_for_clustering</span><span class="p">,</span><span class="w"> </span><span class="n">centers</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">$</span><span class="n">withinss</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">wss</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Number of Clusters"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Within groups sum of squares"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /></p>

<h2 id="kmeans-avec-4-groupes-">Kmeans avec 4 groupes :</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#extraire les comp princ pour visualiser
</span><span class="n">pc.comp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">acp1</span><span class="o">$</span><span class="n">scores</span><span class="w">
</span><span class="n">pc.comp1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-1</span><span class="o">*</span><span class="n">pc.comp</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># principal component 1 scores (negated for convenience)
</span><span class="n">pc.comp2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-1</span><span class="o">*</span><span class="n">pc.comp</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
 
 
</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">pc.comp1</span><span class="p">,</span><span class="w"> </span><span class="n">pc.comp2</span><span class="p">)</span><span class="w">
 
</span><span class="n">cl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">data_for_clustering</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">clusterId</span><span class="o">=</span><span class="n">clusters</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">kmeans_clusterId</span><span class="o">=</span><span class="n">cl</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="n">X</span><span class="p">)</span></code></pre></figure>

<p>résultats du kmeans avec 4 clusters</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">))</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<p>Le nombre de ASI dans chaque groupes :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pander</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">))</span></code></pre></figure>

<p>1   2   3   4 
— — — —
83   4   4   9</p>

<p>les clusters obtenus avec le kmeans, le nuage de points correpondant à ce qu’on a obtenu avec l’ACP</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">pc.comp1</span><span class="p">,</span><span class="w"> </span><span class="n">pc.comp2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">clusterId</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">kmeans_clusterId</span><span class="p">),</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">kmeans_clusterId</span><span class="p">)),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">clusterId</span><span class="p">,</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">kmeans_clusterId</span><span class="p">)),</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">nudge_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ordered_clusters_ids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">),</span><span class="n">decreasing</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span></code></pre></figure>

<h2 id="quelques-asi-du-cluster-1--15-asis">Quelques ASI du cluster 1  (15 ASIs):</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#largest cluster first
</span><span class="w"> 
</span><span class="c1"># ordered_clusters_ids &lt;- order(table(res$kmeans_clusterId),decreasing=T)
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="c1"># par(mar=c(4,3,2,1))
</span><span class="n">cluster1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">kmeans_clusterId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ordered_clusters_ids</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">ids_clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">cluster1</span><span class="o">$</span><span class="n">clusterId</span><span class="p">,</span><span class="m">15</span><span class="p">)</span><span class="w">
 
</span><span class="k">for</span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ids_clusters</span><span class="p">){</span><span class="w">
  </span><span class="n">subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">clusterID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ii</span><span class="p">]</span><span class="w">
  
  </span><span class="c1">#extraction de dates pour créer ASI (Activity Signal of Interest)
</span><span class="w">  </span><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%d/%m/%Y %H:%M"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dates</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"hour"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">))</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_days</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hours"</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Occurences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">freq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">df1.zoo</span><span class="o">&lt;-</span><span class="n">zoo</span><span class="p">(</span><span class="n">freq</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">freq</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#set date to Index
</span><span class="w">  
  </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">zoo</span><span class="p">(,</span><span class="n">seq</span><span class="p">(</span><span class="n">start</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">end</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="s2">"hour"</span><span class="p">)),</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  
  </span><span class="n">ASI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="n">df2</span><span class="p">),</span><span class="w"> </span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">ASI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="s2">"freq"</span><span class="p">)</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">df2</span><span class="p">)</span><span class="w">
  </span><span class="n">ASI</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ASI</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
 
  </span><span class="n">plot</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="n">mtext</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"ASI"</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="s2">"\n"</span><span class="p">,</span><span class="s2">"T = "</span><span class="p">,</span><span class="n">Period_days</span><span class="p">,</span><span class="w"> </span><span class="s2">" days \n"</span><span class="p">,</span><span class="s2">"#Occurences = "</span><span class="p">,</span><span class="w"> </span><span class="n">Occurences</span><span class="p">,</span><span class="w"> </span><span class="s2">" posts"</span><span class="w"> </span><span class="p">))</span><span class="w">
 
</span><span class="c1">#   print(
#   ggplot(ASI, aes(x=as.character(date), y=freq,group=1)) +
#     geom_line(color="blue") +
#     geom_point(color="blue") +
#     expand_limits(y=0) +
#     theme_minimal() +
#     ggtitle(paste("ASI of cluster",i,sep=" ")) +
#     xlab("time") +
#     theme(axis.text.x = element_blank())  +
#     annotate("text", color= "blue", size = 5, x=Inf, y = Inf, label = paste("T = ",Period_days, " days \n", "T = ", Period_hours, " hours \n", "#Occurences = ", Occurences, " posts" ), vjust=1, hjust=1)
# )
</span><span class="p">}</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" /></p>

<h2 id="quelques-asi-du-cluster-4-">Quelques ASI du cluster 4 :</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cluster2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">kmeans_clusterId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ordered_clusters_ids</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">cluster2</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
 
</span><span class="n">ids_clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cluster2</span><span class="o">$</span><span class="n">clusterId</span><span class="w">
 
</span><span class="k">for</span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ids_clusters</span><span class="p">){</span><span class="w">
  </span><span class="n">subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">clusterID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ii</span><span class="p">]</span><span class="w">
  
  </span><span class="c1">#extraction de dates pour créer ASI (Activity Signal of Interest)
</span><span class="w">  </span><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%d/%m/%Y %H:%M"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dates</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"hour"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">))</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_days</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hours"</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Occurences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">freq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">df1.zoo</span><span class="o">&lt;-</span><span class="n">zoo</span><span class="p">(</span><span class="n">freq</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">freq</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#set date to Index
</span><span class="w">  
  </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">zoo</span><span class="p">(,</span><span class="n">seq</span><span class="p">(</span><span class="n">start</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">end</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="s2">"hour"</span><span class="p">)),</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  
  </span><span class="n">ASI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="n">df2</span><span class="p">),</span><span class="w"> </span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">ASI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="s2">"freq"</span><span class="p">)</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">df2</span><span class="p">)</span><span class="w">
  </span><span class="n">ASI</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ASI</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
 
  </span><span class="n">plot</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="n">mtext</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"ASI"</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="s2">"\n"</span><span class="p">,</span><span class="s2">"T = "</span><span class="p">,</span><span class="n">Period_days</span><span class="p">,</span><span class="w"> </span><span class="s2">" days \n"</span><span class="p">,</span><span class="s2">"#Occurences = "</span><span class="p">,</span><span class="w"> </span><span class="n">Occurences</span><span class="p">,</span><span class="w"> </span><span class="s2">" posts"</span><span class="w"> </span><span class="p">))</span><span class="w">
 
</span><span class="c1">#   print(
#   ggplot(ASI, aes(x=as.character(date), y=freq,group=1)) +
#     geom_line(color="blue") +
#     geom_point(color="blue") +
#     expand_limits(y=0) +
#     theme_minimal() +
#     ggtitle(paste("ASI of cluster",i,sep=" ")) +
#     xlab("time") +
#     theme(axis.text.x = element_blank())  +
#     annotate("text", color= "blue", size = 5, x=Inf, y = Inf, label = paste("T = ",Period_days, " days \n", "T = ", Period_hours, " hours \n", "#Occurences = ", Occurences, " posts" ), vjust=1, hjust=1)
# )
</span><span class="p">}</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" /><img src="/figures/unnamed-chunk-19-2.png" alt="plot of chunk unnamed-chunk-19" /></p>

<h2 id="quelques-asi-du-cluster-2-">Quelques ASI du cluster 2 :</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cluster3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">kmeans_clusterId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ordered_clusters_ids</span><span class="p">[</span><span class="m">3</span><span class="p">])</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">cluster3</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
 
</span><span class="n">ids_clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cluster3</span><span class="o">$</span><span class="n">clusterId</span><span class="w">
 
</span><span class="k">for</span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ids_clusters</span><span class="p">){</span><span class="w">
  </span><span class="n">subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">clusterID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ii</span><span class="p">]</span><span class="w">
  
  </span><span class="c1">#extraction de dates pour créer ASI (Activity Signal of Interest)
</span><span class="w">  </span><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%d/%m/%Y %H:%M"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dates</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"hour"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">))</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_days</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hours"</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Occurences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">freq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">df1.zoo</span><span class="o">&lt;-</span><span class="n">zoo</span><span class="p">(</span><span class="n">freq</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">freq</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#set date to Index
</span><span class="w">  
  </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">zoo</span><span class="p">(,</span><span class="n">seq</span><span class="p">(</span><span class="n">start</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">end</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="s2">"hour"</span><span class="p">)),</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  
  </span><span class="n">ASI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="n">df2</span><span class="p">),</span><span class="w"> </span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">ASI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="s2">"freq"</span><span class="p">)</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">df2</span><span class="p">)</span><span class="w">
  </span><span class="n">ASI</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ASI</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
 
  </span><span class="n">plot</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="n">mtext</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"ASI"</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="s2">"\n"</span><span class="p">,</span><span class="s2">"T = "</span><span class="p">,</span><span class="n">Period_days</span><span class="p">,</span><span class="w"> </span><span class="s2">" days \n"</span><span class="p">,</span><span class="s2">"#Occurences = "</span><span class="p">,</span><span class="w"> </span><span class="n">Occurences</span><span class="p">,</span><span class="w"> </span><span class="s2">" posts"</span><span class="w"> </span><span class="p">))</span><span class="w">
 
</span><span class="c1">#   print(
#   ggplot(ASI, aes(x=as.character(date), y=freq,group=1)) +
#     geom_line(color="blue") +
#     geom_point(color="blue") +
#     expand_limits(y=0) +
#     theme_minimal() +
#     ggtitle(paste("ASI of cluster",i,sep=" ")) +
#     xlab("time") +
#     theme(axis.text.x = element_blank())  +
#     annotate("text", color= "blue", size = 5, x=Inf, y = Inf, label = paste("T = ",Period_days, " days \n", "T = ", Period_hours, " hours \n", "#Occurences = ", Occurences, " posts" ), vjust=1, hjust=1)
# )
</span><span class="p">}</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20" /></p>

<h2 id="quelques-asi-du-cluster-3-">Quelques ASI du cluster 3 :</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cluster4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">kmeans_clusterId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ordered_clusters_ids</span><span class="p">[</span><span class="m">4</span><span class="p">])</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">cluster4</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
 
</span><span class="n">ids_clusters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cluster4</span><span class="o">$</span><span class="n">clusterId</span><span class="w">
 
</span><span class="k">for</span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ids_clusters</span><span class="p">){</span><span class="w">
  </span><span class="n">subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">clusterID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ii</span><span class="p">]</span><span class="w">
  
  </span><span class="c1">#extraction de dates pour créer ASI (Activity Signal of Interest)
</span><span class="w">  </span><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">subset</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%d/%m/%Y %H:%M"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">dates</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"hour"</span><span class="p">)</span><span class="w">
  </span><span class="n">rounded_dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">))</span><span class="w">
  </span><span class="n">Period_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_days</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="nf">min</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hours"</span><span class="p">)</span><span class="w">
  </span><span class="n">Period_hours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">Period_hours</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">Occurences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">freq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">rounded_dates</span><span class="p">)</span><span class="w">
  
  </span><span class="n">df1.zoo</span><span class="o">&lt;-</span><span class="n">zoo</span><span class="p">(</span><span class="n">freq</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="n">freq</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w"> </span><span class="c1">#set date to Index
</span><span class="w">  
  </span><span class="n">df2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">merge</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">zoo</span><span class="p">(,</span><span class="n">seq</span><span class="p">(</span><span class="n">start</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">end</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="s2">"hour"</span><span class="p">)),</span><span class="w"> </span><span class="n">all</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  
  </span><span class="n">ASI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="n">time</span><span class="p">(</span><span class="n">df2</span><span class="p">),</span><span class="w"> </span><span class="n">df2</span><span class="p">,</span><span class="w"> </span><span class="n">check.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">ASI</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="s2">"freq"</span><span class="p">)</span><span class="w">
  </span><span class="n">rm</span><span class="p">(</span><span class="n">df1.zoo</span><span class="p">,</span><span class="n">df2</span><span class="p">)</span><span class="w">
  </span><span class="n">ASI</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">ASI</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
 
  </span><span class="n">plot</span><span class="p">(</span><span class="n">ASI</span><span class="o">$</span><span class="n">date</span><span class="p">,</span><span class="n">ASI</span><span class="o">$</span><span class="n">freq</span><span class="p">,</span><span class="n">type</span><span class="o">=</span><span class="s2">"b"</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="n">mtext</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"ASI"</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="s2">"\n"</span><span class="p">,</span><span class="s2">"T = "</span><span class="p">,</span><span class="n">Period_days</span><span class="p">,</span><span class="w"> </span><span class="s2">" days \n"</span><span class="p">,</span><span class="s2">"#Occurences = "</span><span class="p">,</span><span class="w"> </span><span class="n">Occurences</span><span class="p">,</span><span class="w"> </span><span class="s2">" posts"</span><span class="w"> </span><span class="p">))</span><span class="w">
 
</span><span class="c1">#   print(
#   ggplot(ASI, aes(x=as.character(date), y=freq,group=1)) +
#     geom_line(color="blue") +
#     geom_point(color="blue") +
#     expand_limits(y=0) +
#     theme_minimal() +
#     ggtitle(paste("ASI of cluster",i,sep=" ")) +
#     xlab("time") +
#     theme(axis.text.x = element_blank())  +
#     annotate("text", color= "blue", size = 5, x=Inf, y = Inf, label = paste("T = ",Period_days, " days \n", "T = ", Period_hours, " hours \n", "#Occurences = ", Occurences, " posts" ), vjust=1, hjust=1)
# )
</span><span class="p">}</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-21-1.png" alt="plot of chunk unnamed-chunk-21" /></p>

<h2 id="kmeans-avec-3-groupes-">Kmeans avec 3 groupes :</h2>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#extraire les comp princ pour visualiser
</span><span class="n">pc.comp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">acp1</span><span class="o">$</span><span class="n">scores</span><span class="w">
</span><span class="n">pc.comp1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-1</span><span class="o">*</span><span class="n">pc.comp</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c1"># principal component 1 scores (negated for convenience)
</span><span class="n">pc.comp2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-1</span><span class="o">*</span><span class="n">pc.comp</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
 
 
</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">pc.comp1</span><span class="p">,</span><span class="w"> </span><span class="n">pc.comp2</span><span class="p">)</span><span class="w">
 
</span><span class="n">cl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">kmeans</span><span class="p">(</span><span class="n">data_for_clustering</span><span class="p">,</span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">clusterId</span><span class="o">=</span><span class="n">clusters</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="n">kmeans_clusterId</span><span class="o">=</span><span class="n">cl</span><span class="o">$</span><span class="n">cluster</span><span class="p">,</span><span class="n">X</span><span class="p">)</span></code></pre></figure>

<p>résultats du kmeans avec 3 clusters</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">
</span><span class="n">qplot</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">))</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-23-1.png" alt="plot of chunk unnamed-chunk-23" /></p>

<p>les clusters obtenus avec le kmeans, le nuage de points correpondant à ce qu’on a obtenu avec l’ACP</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">pc.comp1</span><span class="p">,</span><span class="w"> </span><span class="n">pc.comp2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">clusterId</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">kmeans_clusterId</span><span class="p">),</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">kmeans_clusterId</span><span class="p">)),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">clusterId</span><span class="p">,</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">kmeans_clusterId</span><span class="p">)),</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">nudge_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-24-1.png" alt="plot of chunk unnamed-chunk-24" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># fviz_cluster(cl, data = clusters)+theme_minimal()+
#   scale_color_manual(values = c("#00AFBB","#2E9FDF", "#E7B800"))+
#   scale_fill_manual(values = c("#00AFBB","#2E9FDF", "#E7B800")) +
</span><span class="err">#</span><span class="w">   </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="w"> </span><span class="s2">"Partitioning Clustering Plot"</span><span class="p">)</span></code></pre></figure>

<p>##Commentaires :</p>

<h1 id="suite">Suite</h1>

<p>Nuage de points et cercle de corrélations sur les autres axes, les couleurs correspondent aux groupes obtenus par kmeans :</p>

<p>Axes 1 et 2 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_pca_biplot</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ind"</span><span class="p">,</span><span class="s2">"var"</span><span class="p">),</span><span class="w"> </span><span class="n">habillage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">,</span><span class="n">col.ind.sup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-26-1.png" alt="plot of chunk unnamed-chunk-26" /></p>

<p>Axes 1 et 3 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_pca_biplot</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ind"</span><span class="p">,</span><span class="s2">"var"</span><span class="p">),</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">habillage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">,</span><span class="n">col.ind.sup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-27-1.png" alt="plot of chunk unnamed-chunk-27" /></p>

<p>Axes 2 et 3 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_pca_biplot</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ind"</span><span class="p">,</span><span class="s2">"var"</span><span class="p">),</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="n">habillage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">kmeans_clusterId</span><span class="p">,</span><span class="n">col.ind.sup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-28-1.png" alt="plot of chunk unnamed-chunk-28" /></p>

<p>Contribution des individus, Axe 1 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_contrib</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ind"</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-29-1.png" alt="plot of chunk unnamed-chunk-29" /></p>

<p>Contribution des individus, Axe 2 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_contrib</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ind"</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-30-1.png" alt="plot of chunk unnamed-chunk-30" /></p>

<p>Contribution des individus, Axe 3 :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_contrib</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ind"</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-31-1.png" alt="plot of chunk unnamed-chunk-31" /></p>

<p>Contribution variables (Axe 1) :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_contrib</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"var"</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-32-1.png" alt="plot of chunk unnamed-chunk-32" /></p>

<p>Contribution variables (Axe 2) :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_contrib</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"var"</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-33-1.png" alt="plot of chunk unnamed-chunk-33" /></p>

<p>Contribution variables (Axe 3) :</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">fviz_contrib</span><span class="p">(</span><span class="n">acp1</span><span class="p">,</span><span class="w"> </span><span class="n">choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"var"</span><span class="p">,</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-34-1.png" alt="plot of chunk unnamed-chunk-34" /></p>


      </article>

      

      

      <ul class="pager blog-pager">
        
        
        <li class="next">
          <a href="/2015-02-20-test-markdown/" data-toggle="tooltip" data-placement="top" title="Test markdown">Next Post &rarr;</a>
        </li>
        
      </ul>

      
        <div class="disqus-comments">
          

        </div>
      
    </div>
  </div>
</div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
		  
          <li>
            <a href="https://twitter.com/m_ghass" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
      
		  
          <li>
            <a href="mailto:m.ghassany@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
          <li>
            <a href="https://linkedin.com/in/mghassany" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
		  
      
      
      
      
		  
        </ul>
        <p class="copyright text-muted">
		  Mohamad Ghassany
		  &nbsp;&bull;&nbsp;
		  2016

		  
	    </p>
	        <!-- Please don't remove this, keep my open source work credited :) -->
		<p class="theme-by text-muted">
		  Theme by
		  <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
		</p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/js/main.js"></script>
    
  




  
  </body>
</html>
